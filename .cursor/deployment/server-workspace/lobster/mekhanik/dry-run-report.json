{
  "ok": true,
  "action_classes": {
    "safe_auto": [
      "cron_run_monitor",
      "escalate",
      "restart_gateway"
    ],
    "risky": [
      "delete_remote_resource",
      "git_commit_push",
      "modify_cron_job",
      "run_hetzner_snapshot"
    ],
    "blocked": [
      "auto_force_push",
      "change_model",
      "rm_files"
    ]
  },
  "prod_enablement_checklist": [
    "State path exists: ~/.openclaw/.runtime/mekhanik-state.json (owner=openclaw, mode 600/640)",
    "Atomic writes enabled (tmp+fsync+rename); monitor state_write_failed incidents",
    "Restart-guard verified: 2 restarts/30m per incident_key; window resets after 30m",
    "Circuit-breaker per incident_key (not global); verify no cross-incident blocking",
    "Rollback: set Mеханик cron enabled=false; preserve incidents.jsonl"
  ],
  "cases": [
    {
      "name": "shared_state_restart_guard",
      "expected": [
        {
          "t": 0,
          "allowed": true
        },
        {
          "t": 600,
          "allowed": true
        },
        {
          "t": 1200,
          "allowed": false,
          "incident": "restart_loop_blocked"
        },
        {
          "t": 1860,
          "allowed": true
        }
      ],
      "actual": [
        {
          "now_offset_s": 0,
          "actual": {
            "incidents": [],
            "actions": [
              {
                "kind": "restart_gateway",
                "allowed": true,
                "approval_required": false
              }
            ],
            "attempts": 1,
            "window_start": 1772091219.9405222
          }
        },
        {
          "now_offset_s": 600,
          "actual": {
            "incidents": [],
            "actions": [
              {
                "kind": "restart_gateway",
                "allowed": true,
                "approval_required": false
              }
            ],
            "attempts": 2,
            "window_start": 1772091219.9405222
          }
        },
        {
          "now_offset_s": 1200,
          "actual": {
            "incidents": [
              {
                "type": "restart_loop_blocked",
                "severity": "critical"
              }
            ],
            "actions": [
              {
                "kind": "restart_gateway",
                "allowed": false,
                "reason": "restart_loop_blocked",
                "approval_required": false
              }
            ],
            "attempts": 2,
            "window_start": 1772091219.9405222
          }
        },
        {
          "now_offset_s": 1860,
          "actual": {
            "incidents": [],
            "actions": [
              {
                "kind": "restart_gateway",
                "allowed": true,
                "approval_required": false
              }
            ],
            "attempts": 1,
            "window_start": 1772093079.9405222
          }
        }
      ]
    },
    {
      "name": "atomic_write_failure",
      "expected": {
        "append_incidents": [
          "state_write_failed"
        ],
        "actions": [
          "safe_stop"
        ]
      },
      "actual": {
        "error": "[Errno 13] Permission denied: '/root/forbidden'",
        "append_incidents": [
          {
            "type": "state_write_failed",
            "severity": "critical"
          }
        ],
        "actions": [
          {
            "kind": "safe_stop",
            "allowed": true
          }
        ]
      }
    }
  ]
}